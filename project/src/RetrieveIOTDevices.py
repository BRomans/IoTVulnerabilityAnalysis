#!/usr/bin/env python

import shodan
import json
import sys

SHODAN_API_KEY = sys.argv[2]

api = shodan.Shodan(SHODAN_API_KEY)

# Wrap the request in a try/ except block to catch errors
try:
    # Search Shodan
    search = sys.argv[1]

    results = api.search(search)

    for result in results['matches']:
        result['type'] = search
        result['SHODAN_API_KEY'] = SHODAN_API_KEY

    # json.dump(results, sys.stdout, indent=4)
    print(json.dumps(results))

except Exception as e:
    print('Error: {}'.format(e))
